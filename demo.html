<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />
  <title>Flows for APEX - Modeler</title>

  <link rel="stylesheet" href="flows4apex.modeler.css" type="text/css">
  <link rel="stylesheet" href="flows4apex.modeler.font.css" type="text/css">
  <link rel="stylesheet" href="flows4apex.modeler.properties-panel.css" type="text/css">
  <link rel="stylesheet" href="bpmn-js-bpmnlint.css" type="text/css">
  <link type="text/css" rel="stylesheet" href=" https://static.oracle.com/cdn/apex/21.1.0/libraries/font-apex/2.1/css/font-apex.min.css">

  <style >
  #canvas {
      height: 80vh;
      background-color: #f0f0f0;
  }

  .flows4apex-modeler {
    position: relative;
  }  
  
  .properties-panel-parent {
    position: absolute;
    top: 0;
    bottom: 0;
    right: 0;
    width: 260px;
    min-width: 260px;
    max-width: 50%;
    z-index: 10;
    border-left: 1px solid #ccc;
    overflow: auto;
    display: block;
    height: 100%;
    background-color: #f0f0f0;
  }
  .properties-panel-parent:empty {
    display: none;
  }
  .properties-panel-parent > .djs-properties-panel {
    padding-bottom: 70px;
    min-height:100%;
  }
  </style>
</head>

<body>
  <div class="flows4apex-modeler">
    <div id="canvas"></div>
    <div id="properties" class="properties-panel-parent"></div>
  </div>
  <script>
    window.f4a = window.f4a || {};
    window.f4a.language = 'fr';
  </script>
  <script src="./bundle.js"></script>
  <script>
    var myModeler = new bpmnModeler.Modeler({
      container: "#canvas",
      keyboard: { bindTo: document },
      propertiesPanel: {
        parent: '#properties'
      },
      linting: {
        bpmnlint: bpmnModeler.linting.apexLinting
      },
      additionalModules: [
        bpmnModeler.customModules.propertiesPanelModule,
        bpmnModeler.customModules.propertiesProviderModule,
        bpmnModeler.customModules.lintModule,
        bpmnModeler.customModules.customPaletteProviderModule,
        bpmnModeler.customModules.translationModule
      ],
      moddleExtensions: {
        apex: bpmnModeler.moddleExtensions.apexModdleDescriptor
      }
    });

    async function init() {

      openDiagram();

      async function openDiagram() {
        const defaultDiagram =
          "<?xml version='1.0' encoding='UTF-8'?>" +
          "<bpmn:definitions xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xmlns:bpmn='http://www.omg.org/spec/BPMN/20100524/MODEL' xmlns:bpmndi='http://www.omg.org/spec/BPMN/20100524/DI' id='Definitions_1wzb475' targetNamespace='http://bpmn.io/schema/bpmn' exporter='bpmn-js (https://demo.bpmn.io)' exporterVersion='7.2.0'>" +
          "<bpmn:process id='Process_0rxermh' isExecutable='false' />" +
          "<bpmndi:BPMNDiagram id='BPMNDiagram_1'>" +
          "<bpmndi:BPMNPlane id='BPMNPlane_1' bpmnElement='Process_0rxermh' />" +
          "</bpmndi:BPMNDiagram>" +
          "</bpmn:definitions>";

        // import diagram
        try {
          await myModeler.importXML(defaultDiagram);

          // access viewer components
          var canvas = myModeler.get("canvas");
          var overlays = myModeler.get("overlays");

          // zoom to fit full viewport
          canvas.zoom("fit-viewport");
        } catch (err) {
          console.error("could not import BPMN 2.0 diagram", err);
        }
      }
    }

    init();
  </script>
   <script>
    async function logXml() {
      try {
        const result = await myModeler.saveXML( { format: true } );
        const { xml } = result;
        console.log(xml);
      } catch (err) {
        console.log( "Log Diagram failed." );
      }
    }
  </script>
  <button onclick="logXml()">Test</button>
</body>
</html>